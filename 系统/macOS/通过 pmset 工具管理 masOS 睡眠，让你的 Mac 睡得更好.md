# [é€šè¿‡ pmset å·¥å…·ç®¡ç† masOS ç¡çœ ï¼Œè®©ä½ çš„ Mac ç¡å¾—æ›´å¥½](https://sspai.com/post/61379)

> Power Manager Setting (pmset) æ˜¯ macOS çš„ç³»ç»Ÿçº§ç”µæ± ç®¡ç†å·¥å…·ï¼Œé€šè¿‡è°ƒæ•´ macOS çš„ç¡çœ è®¡åˆ’ï¼Œå¯ä»¥è®©Macç¡å¾—æ›´ã€Œå¥½ã€ï¼Œè¾¾åˆ° ã€Œæ’ç”µå“åº”å¿«ï¼Œæ–­ç”µç”¨å¾—ä¹…ã€ çš„ç†æƒ³ç›®æ ‡ã€‚

## Mac æ˜¯æ€ä¹ˆç¡è§‰çš„ï¼Ÿ

Mac çš„ç¡è§‰åˆ†æˆä¸¤ç§ï¼Œ**ã€Œä¼‘çœ ã€ (sleep)** å’Œ **ã€Œç¡çœ ã€ (hibernate)**ã€‚ç®€å•ç‚¹è¯´ï¼Œä¼‘çœ å’Œç¡çœ å°±å¥½æ¯”äººçš„å°æ†©å’Œç¡å¤§è§‰ï¼Œå°æ†©é†’å¾—å¿«ï¼Œç¡å¤§è§‰å°±é†’å¾—æ…¢ã€‚

å½“ä½ é•¿æ—¶é—´ä¸æ“ä½œ Mac æˆ–æŠŠ MacBook çš„ç›–å­åˆä¸Šæˆ–ç‚¹å‡» Apple Logo èœå•ä¸‹çš„ Sleep é€‰é¡¹ï¼Œç³»ç»Ÿä¼šè¿›å…¥**ã€Œä¼‘çœ ã€**çŠ¶æ€ï¼Œç”±äºæ•°æ®ä»å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œæ­¤æ—¶ç³»ç»Ÿå¯ä»¥è¢«å¿«é€Ÿå”¤é†’ï¼Œå¿«é€Ÿæ¢å¤åˆ°ä¼‘çœ å‰çš„çŠ¶æ€ã€‚

åœ¨ã€Œä¼‘çœ ã€ä¸€æ®µæ—¶é—´åï¼ŒMac ä¼šæ ¹æ®ä½ çš„è®¾å®šè¿›å…¥æ›´æ·±ä¸€å±‚çš„ **ã€Œç¡çœ ã€** çŠ¶æ€ï¼Œæ­¤æ—¶ Mac ä¼šè€ƒè™‘å°†å†…å­˜ä¸­çš„æ•°æ®ä½œä¸ºä¸€ä¸ªé•œåƒå†™å…¥åˆ°ç¡¬ç›˜ä¸­ï¼ˆGB çº§åˆ«å¤§å°ï¼‰ï¼Œç„¶åæ”¾å¼ƒå†…å­˜ä¾›ç”µï¼Œè¾¾åˆ°æ›´åŠ çœç”µçš„ç›®çš„ã€‚æ­¤æ—¶å”¤é†’ç³»ç»Ÿï¼Œæ•°æ®éœ€è¦ä»ç¡¬ç›˜é‡æ–°è£…è½½è‡³å†…å­˜ï¼Œè€—æ—¶é•¿ï¼Œé€Ÿåº¦æ…¢ã€‚

æ€»ç»“ä¸€ä¸‹ï¼Œã€Œä¼‘çœ ã€å’Œã€Œç¡çœ ã€çš„ä¸»è¦åŒºåˆ«ï¼š

- å”¤é†’é€Ÿåº¦å¿«æ…¢
- æ˜¯å¦å‘å†…å­˜ä¾›ç”µ
- æ˜¯å¦å‘ç¡¬ç›˜å†™å…¥å†…å­˜é•œåƒ

å½“ç„¶ï¼ŒMac åˆ°åº•è¦æ€ä¹ˆã€Œç¡ã€ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥é€šè¿‡ `pmset` è°ƒæ•´çš„ã€‚

## macOS ç³»ç»Ÿç¡çœ æµç¨‹

![img](../../_ImageAssets/1-1421411.png)macOS ç¡çœ æµç¨‹å›¾

å¦‚å›¾æ‰€ç¤ºï¼Œå½“æˆ‘ä»¬ä¸ä½¿ç”¨ Mac æ—¶ï¼Œä¸€æ®µæ—¶å€™åï¼Œç³»ç»Ÿå…ˆè¿›å…¥ `sleep` çŠ¶æ€ï¼Œç„¶åæ ¹æ® `hibernatemode` çš„æ¨¡å¼ï¼Œå†³å®šå°†é•œåƒæ•°æ®å†™å…¥å†…å­˜è¿˜æ˜¯ç¡¬ç›˜ã€‚

`standby` å’Œ `autopoweroff` ç›¸å½“äºä¸¤ä¸ªå¹¶è¡Œçš„æ¨¡å¼è®¡æ—¶å™¨ï¼ŒMac ä¼šæ ¹æ®å½“å‰ä¾›ç”µæ¡ä»¶ä½œå‡ºæ¨¡å¼çš„é€‰æ‹©ï¼Œåœ¨è®¡æ—¶å™¨é˜¶æ®µå†…ï¼Œå½“æ—¶é—´æ¡ä»¶æ»¡è¶³ï¼ŒMac å°±ä¼šå°†é•œåƒå†™å…¥ç¡¬ç›˜å¹¶ç¡çœ ã€‚

## pmset ç”¨æ³•

```
sudo pmset [-é€‰é¡¹] <å‚æ•°>
```

ä¾‹å­ï¼š

- `pmset -g custom`ï¼šæŸ¥çœ‹å½“å‰æ‰€æœ‰ç¡çœ è®¡åˆ’
- `pmset -g cap`ï¼šæŸ¥çœ‹å½“å‰ä¾›ç”µæ¡ä»¶ä¸‹å¯ä»¥è°ƒèŠ‚çš„å‚æ•°
- `sudo pmset restoredefaults`ï¼šè¿˜åŸå…¨éƒ¨è®¾ç½®

### å¸¸ç”¨é€‰é¡¹

- `pmset -a`ï¼šè°ƒæ•´ä»»ä½•æ¡ä»¶ä¸‹çš„ç¡çœ è®¡åˆ’
- `pmset -c`ï¼šè°ƒæ•´å¤–éƒ¨ä¾›ç”µçš„ç¡çœ è®¡åˆ’
- `pmset -b`ï¼šè°ƒæ•´ç”µæ± ä¾›ç”µçš„ç¡çœ è®¡åˆ’
- `pmset -g`ï¼šæŸ¥çœ‹è®¡åˆ’

### å¸¸ç”¨å‚æ•°

ğŸ¨ **sleep**

sleep æ§åˆ¶è¿›å…¥ä¼‘çœ æ‰€éœ€è¦çš„ç©ºé—²æ—¶é—´

ğŸ¨ **hibernatemode**

> hibernatemode supports values of 0, 3, or 25. Whether or not a hibernation image gets written is also dependent on the values of standby and autopoweroff.

hibernatemode è´Ÿè´£ç®¡ç†ç¡çœ æ¨¡å¼ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¼‘çœ æ—¶çš„å†…å­˜é•œåƒæ˜¯å¦å†™å…¥ç¡¬ç›˜ï¼Œé™¤äº†å— `hibernatemode` çš„æ§åˆ¶ï¼Œè¿˜å’Œ `standby` ä»¥åŠ `autopoweroff` çš„å€¼æœ‰å…³ã€‚

hibernatemode æœ‰ 3 ç§ä¼‘çœ æ¨¡å¼å¯é€‰æ‹©

- `hibernatemode = 0`
  - **iMac, Mac Miniç­‰ Macæ¡Œé¢è®¾å¤‡é»˜è®¤å‚æ•°**
  - æŒç»­å‘å†…å­˜ä¾›ç”µï¼Œå°†æ•°æ®ä¿ç•™åœ¨å†…å­˜
  - å”¤é†’é€Ÿåº¦å¿«ï¼Œå‡å°‘ç¡¬ç›˜å ç”¨
  - æ•°æ®æœ‰ä¸¢å¤±é£é™©
  - è€—ç”µé‡å¤§

- `hibernatemode = 25`
  - å°†æ•°æ®å†™å…¥ç¡¬ç›˜
  - ä¸å‘å†…å­˜ä¾›ç”µï¼Œå°†å†…å­˜é•œåƒç›´æ¥å†™å…¥ç¡¬ç›˜
  - æ•°æ®ä¸æ˜“ä¸¢å¤±ï¼Œé•œåƒå ç”¨ç¡¬ç›˜ç©ºé—´
  - å”¤é†’é€Ÿåº¦æ…¢
  - è€—ç”µé‡å°‘

- `hibernatemode = 3`
  - **MacBook ç¬”è®°æœ¬è®¾å¤‡é»˜è®¤å‚æ•°**
  - safe sleep, æ•°æ®æ—¢å†™å…¥å†…å­˜åˆå†™å…¥ç¡¬ç›˜
  - æŒç»­å‘å†…å­˜ä¾›ç”µ
  - å”¤é†’æ—¶ï¼Œæ ¹æ®è®¾å¤‡ç”µé‡è‡ªåŠ¨é€‰æ‹©ä» å†…å­˜/ç¡¬ç›˜ æ¢å¤

ğŸ¨ **standby**

> standby causes kernel power management to automatically hibernate a machine after it has slept for a specified time period.

standby æ˜¯ Mac åœ¨ä¼‘çœ æ—¶çš„è®¡æ—¶å™¨ï¼Œå½“æ»¡è¶³æ—¶é—´æ¡ä»¶ï¼ŒMacå°±ä¼šç”±ã€Œä¼‘çœ ã€çŠ¶æ€è½¬è‡³ã€Œç¡çœ ã€çŠ¶æ€ã€‚

standbyæ¨¡å¼éœ€è¦ä»¥ä¸‹æ¡ä»¶ï¼š

- **ç”µæ± ä¾›ç”µ**
- æ²¡æœ‰å¤–æ¥è®¾å¤‡
- æ²¡æœ‰ç½‘ç»œæ´»åŠ¨
- æ²¡æœ‰å¤–æ¥æ˜¾ç¤ºå™¨

åœ¨æ»¡è¶³æ¡ä»¶çš„å‰æä¸‹ï¼Œ `standbydelayhigh/low` ç§’åï¼Œä¼šè¿›è¡Œç¡çœ ã€‚æ¯”è¾ƒäººæ€§åŒ–çš„çš„ä¸€ç‚¹æ˜¯ï¼Œstandby æä¾›äº†ä¸¤ä¸ªå€’è®¡æ—¶ï¼Œé€šè¿‡ä¸€ä¸ªé˜ˆå€¼ (`highstandbythreshold`) è¿›è¡Œæ§åˆ¶ã€‚

ğŸ¨ **highstandbythreshold**

highstandbythreshold(ç”µæ± å‰©ä½™ç”µé‡ç™¾åˆ†æ¯”)å®ƒæ˜¯`standbydelay`æ¨¡å¼é€‰æ‹©é˜ˆå€¼ï¼Œé»˜è®¤ 50% ç”µé‡ã€‚

- é«˜äºé˜ˆå€¼ï¼Œé‡‡ç”¨ `standbydelayhigh` è®¡ç®—æ—¶é—´ã€‚
- ä½äºé˜ˆå€¼ï¼Œé‡‡ç”¨ `standbydelaylow` è®¡ç®—æ—¶é—´ã€‚

ğŸ¨ **autopoweroff**

> autopoweroff is enabled by default on supported platforms as an implementation of Lot 6 to the European Energy-related Products Directive. After sleeping for <autopoweroffdelay> seconds, the system will write a hibernation image and go into a lower power chipset sleep. Wakeups from this state will take longer than wakeups from regular sleep.

autppoweroff æ˜¯ä¸ºäº†æ»¡è¶³ [æ¬§ç›Ÿèƒ½æºæ•ˆç‡ Lot 6 æ¡ä¾‹](https://ac-dc.powerint.cn/sites/default/files/greenroom/docs/EC_1275_2008PublishedRegulation.pdf)ï¼ˆå…³äºå¾…æœºå’Œå…³é—­æ¨¡å¼çš„è¦æ±‚ï¼‰è€Œè®¾è®¡çš„ï¼Œä½†å¹¶ä¸æ˜¯å…¨éƒ¨è®¾å¤‡éƒ½æœ‰è¿™ä¸ªè¿™ä¸ªè®¾å®šï¼Œéœ€è¦é€šè¿‡ `pmset -g cap` æŸ¥çœ‹æ˜¯å¦èƒ½è°ƒèŠ‚æ­¤é¡¹å‚æ•°ã€‚

`autopoweroff`æ¨¡å¼éœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š

- **å¤–éƒ¨ç”µæºä¾›ç”µ**
- æ²¡æœ‰å¤–æ¥è®¾å¤‡
- æ²¡æœ‰ç½‘ç»œæ´»åŠ¨

åœ¨æ»¡è¶³æ¡ä»¶çš„å‰æä¸‹, `autopoweroffdelay`ç§’åï¼Œç³»ç»Ÿä¼šå†™å…¥å†…å­˜é•œåƒç„¶åç¡çœ ã€‚ä¸ä¸Šæ–‡æåˆ°çš„ `standby` ä¸åŒï¼Œ`autppoweroff` æ›´å¤šæ˜¯ä¸ºäº†è¿æ¥å¤–éƒ¨ç”µæºå……ç”µæ—¶è®¾è®¡çš„ã€‚

### ğŸ¨ **gpuswitch**

`gpuswitch` è¿™ä¸ªå‚æ•°ç”¨äºç®¡ç†æ˜¾å¡çš„é€‰æ‹©ï¼Œé€‚åˆæœ‰ç‹¬ç«‹æ˜¾å¡/å¤–ç½®æ˜¾å¡çš„ Mac

- `gpuswitch=0` åªä½¿ç”¨é›†æˆæ˜¾å¡
- `gpuswitch=1` åªä½¿ç”¨ç‹¬ç«‹æ˜¾å¡
- `gpuswitch=2` è‡ªåŠ¨åˆ‡æ¢æ˜¾å¡

è°ƒèŠ‚è¿™ä¸ªå‚æ•°å¯ä»¥é¿å…åœ¨ç”µæ± ä¾›ç”µæ—¶ä½¿ç”¨è€—ç”µé‡é«˜çš„ç‹¬ç«‹æ˜¾å¡ï¼Œä»¥èŠ‚çœç”µé‡ã€‚

**å…¶ä»–å¸¸ç”¨å‚æ•°**

- `lidwake`ï¼šå¼€ç›–æ—¶æ˜¯å¦å”¤é†’
- `tcpkeepalive`ï¼šåˆç›–æ—¶æ˜¯å¦ä¿å­˜ç½‘ç»œè¿æ¥
- `displaysleep`ï¼šå±å¹•ä¼‘çœ æ—¶é—´
- `disksleep`ï¼š ç¡¬ç›˜ä¼‘çœ æ—¶é—´
- `acwake`: è¢«åŒä¸€ iCloud ID ä¸‹çš„è®¾å¤‡å”¤é†’

æ›´å¤šå‚æ•°åœ¨ç»ˆç«¯è¿è¡Œ `$ man pmset`, æŸ¥é˜… `pmset` çš„è¯´æ˜

## ğŸŒŸ ä¸ªäººè®¾ç½®æ–¹æ¡ˆ

æˆ‘ä¸ªäººæ‰€å¸Œæœ›çš„ç¡çœ è®¡åˆ’æ˜¯ï¼šå¤–æ¥ä¾›ç”µæ¡ä»¶ä¸‹å“åº”å°½å¯èƒ½å¿«ï¼Œç”µæ± ä¾›ç”µæ¡ä»¶ä¸‹è€—ç”µå°‘ã€‚

### âš¡ï¸ å¤–éƒ¨ä¾›ç”µä¸‹çš„ pmset è®¾ç½®

![img](../../_ImageAssets/1-20210519185011189.png)å¤–éƒ¨ä¾›ç”µæ—¶çš„è®¾ç½®

åœ¨è¿›è¡Œå¤–éƒ¨ä¾›ç”µçš„æ—¶å€™ï¼Œæˆ‘å¸Œæœ› MacBook æ˜¯å¤„äºä¸€ä¸ª **ã€Œæ—¶åˆ»å‡†å¤‡ç€ã€** çš„çŠ¶æ€ï¼ˆå‚è€ƒ iMac ï¼‰ï¼Œå› æ­¤æˆ‘å¸Œæœ›æˆ‘çš„ Macèƒ½æ¸…é†’æ›´ä¹…ï¼Œå¹¶ä¸”æ°¸ä¸ ã€Œç¡çœ ã€ã€‚å› æ­¤æˆ‘ä¼šä½œå‡ºä»¥ä¸‹è®¾ç½®ï¼š

**æ°¸ä¸ç¡çœ ï¼š**

- `hibernatemode` è®¾ç½®æˆ `0`ï¼Œè®©å¤–éƒ¨ç”µæºæŒç»­ç»™å†…å­˜ä¾›ç”µã€‚
- å…³é—­ `standyby` å’Œ `autopoweroff` æ¨¡å¼ï¼Œé˜»æ­¢ MacBook ç¡çœ ã€‚

**è¯¦ç»†è®¾ç½®ï¼š**

```
// 120 åˆ†é’Ÿåè¿›å…¥ä¼‘çœ ï¼Œå»¶é•¿æ¸…é†’æ—¶é—´ sudo pmset -c sleep 120 // æ˜¾ç¤ºå™¨ä¼‘çœ æ—¶é—´ï¼š30 åˆ†é’Ÿ sudo pmset -c displaysleep 30 // ç¡¬ç›˜ä¼‘çœ æ—¶é—´ï¼š60 åˆ†é’Ÿ sudo pmset -c disksleep 60 // å†…å­˜ä¾›ç”µï¼Œå†…å­˜é•œåƒä¸å†™å…¥ç¡¬ç›˜ sudo pmset -c hibernatemode 0 // å…³é—­ standby æ¨¡å¼ sudo pmset -c standby 0 // å…³é—­ autopoweroff sudo pmset -c autopoweroff 0 // ä¼‘çœ æ—¶æŒç»­è”ç½‘ sudo pmset -c tcpkeepalive 1
```

### ğŸ”‹ ç”µæ± ä¾›ç”µä¸‹çš„ pmset è®¾ç½®

![img](../../_ImageAssets/1-20210519185011209.png)ç”µæ± ä¾›ç”µæ—¶çš„è®¾ç½®

åœ¨é€šè¿‡ç”µæ± ä¾›ç”µçš„æ—¶å€™ï¼Œæˆ‘å¸Œæœ› Mac èƒ½è€—ç”µå°‘ä¸€äº›ï¼ŒåŒæ—¶ã€Œç¡çœ ã€åå”¤é†’é€Ÿåº¦ä¸å¤ªæ…¢ã€‚å› æ­¤æˆ‘ä¼šä½œå‡ºä»¥ä¸‹è®¾ç½®ï¼š

- `hibernatemode` ä¸º `3`ï¼Œå°†é•œåƒæ•°æ®æ—¢å†™å…¥å†…å­˜åˆå†™å…¥ç¡¬ç›˜ï¼ŒåŒæ—¶å¯¹å†…å­˜åªä¾›ç”µä¸€æ®µæ—¶é—´ã€‚
- `standby` çš„ç”µé‡é˜ˆå€¼è®¾ç½®æˆ `75%`ï¼Œå½“ç”µé‡ä½äº 75% stanbyçš„è®¡æ—¶å™¨å°±ä½¿ç”¨ `standbydelaylow` ä½œä¸ºä¼‘çœ å€’è®¡æ—¶ã€‚
- `tcpkeepalive` è®¾ç½®æˆ `0`, ä¼‘çœ æ—¶ç”µè„‘å°†ä¼šæ–­ç½‘ï¼Œä»¥èŠ‚çœç”µé‡ã€‚ä½†æ­¤æ—¶æ— æ³•è¿›è¡Œä¸‹è½½å·¥ä½œï¼Œ**FindMy ä¹Ÿæ— æ³•å®šä½ã€‚**
- `proximitywake` è®¾ç½®æˆ 0, å…³é—­è¢«åŒä¸€ç½‘ç»œä¸‹çš„åŒ iCloud è®¾å¤‡å”¤é†’

**è¯¦ç»†è®¾ç½®ï¼š**

```
// 20 åˆ†é’Ÿåè¿›å…¥ä¼‘çœ 
sudo pmset -b sleep 20
// å‘ç¡¬ç›˜å†™å…¥é•œåƒï¼ŒåŒæ—¶å†…å­˜ä¾›ç”µ
sudo pmset -b hibernatemode 3
// æ˜¾ç¤ºå™¨ä¼‘çœ æ—¶é—´ï¼š15 åˆ†é’Ÿ
sudo pmset -b displaysleep 15
// ç¡¬ç›˜ä¼‘çœ æ—¶é—´ï¼š30 åˆ†é’Ÿ
sudo pmset -b disksleep 30
// ä¼‘çœ æ—¶æ–­ç½‘
sudo pmset -b tcpkeepalive 0
// é«˜ç”µé‡ä¸‹ standby: 4å°æ—¶
sudo pmset -b standbydelayhigh 14400
// ä½ç”µé‡ä¸‹ standby: 2å°æ—¶
sudo pmset -b standbydelaylow 7200
// standby ç”µé‡é˜ˆå€¼ï¼š75%
sudo pmset -b highstandbythreshold 75
// å¼€ç›–å”¤é†’
sudo pmset -b lidwake 1
// å…³é—­è¢«åŒä¸€ iCloud ä¸‹çš„è®¾å¤‡å”¤é†’
sudo pmset -b acwake 0
```

ğŸ“– å‚è€ƒèµ„æ–™:

- StackExchange: [Difference between autopoweroff and standby in pmset](https://apple.stackexchange.com/questions/113954/difference-between-autopoweroff-and-standby-in-pmset)
- tutsplus: [How to Hibernate a Mac](https://computers.tutsplus.com/tutorials/how-to-hibernate-a-mac--cms-23235)
- WikiPedia: [pmset](https://en.wikipedia.org/wiki/Pmset)

P.S. ã€ŒHibernateã€ è‹±æ–‡ç›´è¯‘ä¸ºã€Œç¡å¾—æ·±çš„ç¡çœ ï¼Œå¦‚å†¬çœ ã€ï¼Œæœ¬æ–‡å–ã€Œç¡çœ ã€ä¹‹ä¹‰ï¼Œä»¥è¡¨è¾¾è®¾å¤‡çš„ä½åŠŸè€—è¿ä½œã€‚